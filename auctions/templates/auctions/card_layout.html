<!--
Get class: 'item': Listing(), 'ret_url, 'ret_close_url', 'exist_in_wishlist'},
ret_url(for a raise and change wishlist), ret_close_url - for close listing value.
-->

{% load static %}
{% load humanize %}
{% block card %}

{% for item in listing %}
    <div class="card mb-3 mx-auto" style="max-width: 960px;">
      <div class="card-header text-center"><h3 class="mx-auto">{{ item.listing.title }} </h3> </div>
      <div class="row no-gutters">

            <div class="col-md-4">
              {% if item.listing.image_url %}
                  <img src="{{ item.listing.image_url }}" class="card-img-top" alt="Image for {{ item.listing.title }}">
              {% else %}
                  <img src="{% static 'auctions/no_image.jpg' %}" class="card-img-top" alt="Image for {{ item.listing.title }}">
              {% endif %}
            </div>

            <div class="col-md-8">
                  <div class="card-body">
                        <h6 class="card-subtitle mb-3 text-muted">Category: {{ item.listing.category }}</h6>
                        <p class="card-text">{{ item.listing.description }}</p>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="btn btn-info">{{ item.listing.start_value|intcomma }} $</span>
                                <span class="btn btn-primary">{{ item.listing.get_current_bid.value|intcomma }} $</span>
                            </div>
                  {% if user.is_authenticated %}
                            <form action="{% url 'auctions:listing' item.listing.id %}/raise" method="post" class="form-inline">
                                {% csrf_token %}
                                <input type="hidden" name="ret_url" value="{{ item.ret_url }}">
                                <input type="number" name="value" min="{{ item.listing.get_current_bid.value|add:"1" }}" class="form-control"  aria-label="bid" aria-describedby="button-addon2">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-success" type="submit" id="button-addon2">Raise</button>
                                </div>
                            </form>

                        </div>

                        <form action="{% url 'auctions:listing' item.listing.id %}/change_wishlist" method="post" class="form-inline">
                            {% csrf_token %}
                            <input type="hidden" name="ret_url" value="{{ item.ret_url }}">
                            {% if item.exist_in_wishlist %}
                                <button class="btn btn-outline-info mt-4" type="submit">Delete from wishlist</button>
                            {% else %}
                                <button class="btn btn-outline-info mt-4" type="submit">Add to wishlist</button>
                            {% endif %}
                        </form>
                        {% comment %} If user owner of listing â€” he can close it {% endcomment %}
                        {% if user == item.listing.user %}
                        <form action="{% url 'auctions:close_listing' item.listing.id %}" method="post" class="form-inline">
                            {% csrf_token %}
                            <input type="hidden" name="ret_url" value="{{ item.ret_close_url }}">
                            <button class="btn btn-outline-danger mt-4" type="submit">Close listing</button>
                        </form>
                        {% endif %}

                  {% else %}
                        </div>
                  {% endif %}
                  </div>
            </div>
      </div>
      <div class="card-footer text-muted">
        Published at {{ item.listing.timestamp }}
      </div>
    </div>
{% empty %}
<h2>There are not listings yet.</h2>
{% endfor %}

{% endblock %}